<form action="/generate" method="post">
  <button type="submit">Generate Tracking Link</button>
</form>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Location Tracking Links</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: #fff;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem;
    box-sizing: border-box;
  }
  .container {
    background: rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 2rem 3rem;
    max-width: 460px;
    width: 100%;
    box-shadow: 0 12px 30px rgba(0,0,0,0.3);
    text-align: center;
  }
  h1 {
    margin-bottom: 1rem;
    font-weight: 600;
    font-size: 2rem;
  }
  label {
    display: block;
    margin-bottom: 0.6rem;
    font-weight: 600;
    text-align: left;
  }
  input[type="text"] {
    width: 100%;
    padding: 0.6rem 1rem;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    outline: none;
  }
  button {
    margin-top: 1rem;
    background: #fff;
    color: #764ba2;
    border: none;
    border-radius: 8px;
    padding: 0.8rem 1.6rem;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background: #f4f4f4;
  }
  .output {
    margin-top: 1.5rem;
    background: rgba(255,255,255,0.15);
    padding: 1rem;
    border-radius: 8px;
    font-size: 0.95rem;
    word-break: break-word;
  }
  .location-info {
    margin-top: 1rem;
    background: rgba(255,255,255,0.15);
    padding: 1rem;
    border-radius: 8px;
    text-align: left;
    font-size: 1rem;
  }
  .footer {
    margin-top: 1.8rem;
    font-size: 0.9rem;
    opacity: 0.75;
  }
  a {
    color: #ffda79;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>
</head>
<body>
<div class="container" id="app">
  <h1>Location Tracking Links</h1>
  <div id="create-section" style="display:none;">
    <form id="create-form">
      <label for="trackerName">Tracking Link Name (optional):</label>
      <input type="text" id="trackerName" placeholder="e.g. Friend's Visit" maxlength="40" />
      <button type="submit">Create Tracking Link</button>
    </form>
    <div class="output" id="tracking-link-output" style="display:none;"></div>
  </div>

  <div id="track-section" style="display:none;">
    <p>Tracking ID detected: <strong id="tracking-id"></strong></p>
    <button id="locate-btn">Get My Location</button>
    <div class="location-info" id="location-info" style="display:none;"></div>
  </div>

  <div class="footer">
    &copy; 2024 Location Tracker &nbsp;|&nbsp; Built with ðŸ’œ by BLACKBOXAI
  </div>
</div>

<script>
  (function(){
    const app = document.getElementById('app');
    const createSection = document.getElementById('create-section');
    const trackSection = document.getElementById('track-section');
    const trackingLinkOutput = document.getElementById('tracking-link-output');
    const trackingIdElem = document.getElementById('tracking-id');
    const locationInfo = document.getElementById('location-info');
    const locateBtn = document.getElementById('locate-btn');
    const createForm = document.getElementById('create-form');
    const trackerNameInput = document.getElementById('trackerName');

    // Utility: generate random tracking ID:
    function generateTrackingId() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let id = '';
      for(let i=0; i<12; i++) {
        id += chars.charAt(Math.floor(Math.random()*chars.length));
      }
      return id;
    }

    // Utility: get current page base URL (without query or hash)
    function getBaseUrl() {
      return window.location.origin + window.location.pathname;
    }

    // Utility: parse query param ?track=ID
    function getTrackingIdFromURL() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('track');
      return id && id.trim().length > 0 ? id.trim() : null;
    }

    // Utility: display location with formatting
    function displayLocation(coords, timestamp) {
      const date = new Date(timestamp);
      locationInfo.innerHTML = `
        <strong>Latitude:</strong> ${coords.latitude.toFixed(6)}<br />
        <strong>Longitude:</strong> ${coords.longitude.toFixed(6)}<br />
        <strong>Accuracy:</strong> Â±${coords.accuracy} meters<br />
        <strong>Timestamp:</strong> ${date.toLocaleString()}<br />
      `;
    }

    // On page load:
    function init() {
      const trackingId = getTrackingIdFromURL();
      if (trackingId) {
        // Show track section
        createSection.style.display = 'none';
        trackSection.style.display = 'block';
        trackingIdElem.textContent = trackingId;

        locateBtn.addEventListener('click', () => {
          locationInfo.style.display = 'none';
          locationInfo.textContent = 'Locating... Please allow location access.';
          locationInfo.style.display = 'block';

          if (!navigator.geolocation) {
            locationInfo.textContent = 'Geolocation is not supported by your browser.';
            return;
          }
          navigator.geolocation.getCurrentPosition(
            (pos) => {
              displayLocation(pos.coords, pos.timestamp);
            },
            (err) => {
              switch(err.code) {
                case err.PERMISSION_DENIED:
                  locationInfo.textContent = 'Permission denied. Unable to retrieve location.';
                  break;
                case err.POSITION_UNAVAILABLE:
                  locationInfo.textContent = 'Location information is unavailable.';
                  break;
                case err.TIMEOUT:
                  locationInfo.textContent = 'The request to get your location timed out.';
                  break;
                default:
                  locationInfo.textContent = 'An unknown error occurred retrieving location.';
              }
            },
            { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
          );
        });
      } else {
        // Show create section
        createSection.style.display = 'block';
        trackSection.style.display = 'none';

        createForm.addEventListener('submit', (event) => {
          event.preventDefault();
          const name = (trackerNameInput.value || '').trim();
          const id = generateTrackingId();
          // Create full tracking URL with param track=id
          let url = getBaseUrl() + '?track=' + encodeURIComponent(id);
          if (name.length > 0) {
            url += '&name=' + encodeURIComponent(name);
          }

          trackingLinkOutput.style.display = 'block';
          trackingLinkOutput.innerHTML = `
            <strong>Your Tracking Link:</strong><br />
            <a href="${url}" target="_blank" rel="noopener noreferrer" style="color:#ffda79;">${url}</a>
            <br /><small>Share this link with the person you want to track location from.</small>
          `;
          trackerNameInput.value = '';
        });
      }
    }

    init();
  })();
</script>
</body>
</html>

